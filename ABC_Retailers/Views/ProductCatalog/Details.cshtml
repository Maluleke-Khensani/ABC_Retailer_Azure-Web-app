@model ABC_Retailers.Models.ProductCatalog

@using Microsoft.AspNetCore.Http
@inject IHttpContextAccessor HttpContextAccessor

@{
    var user = HttpContextAccessor.HttpContext?.User;
    if (user != null && user.IsInRole("Admin"))
    {
        Layout = "_LayoutAdmin";
    }
    else
    {
        Layout = "_LayoutCustomer";
    }
}

@{
    ViewData["Title"] = "Product Details";
}

<div class="product-details-container">
    <div class="product-image">
        <img src="@(Model.ImageUrl ?? "/images/placeholder.png")" alt="@Model.ProductName" />
    </div>

    <div class="product-info">
        <h2>@Model.ProductName</h2>

        <dl class="product-fields">
            <dt>Category:</dt>
            <dd>@Model.Category</dd>

            <dt>Price:</dt>
            <dd>@Model.Price.ToString("C")</dd>

            @if (!string.IsNullOrWhiteSpace(Model.Description))
            {
                <dt>Description:</dt>
                <dd>@Model.Description</dd>
            }

            @* Add any additional product fields here dynamically if needed *@
            @* Example: Stock Quantity *@
            @if (Model.GetType().GetProperty("StockQuantity") != null)
            {
                <dt>Stock Quantity:</dt>
                <dd>@Model.Stock</dd>
            }
        </dl>

        <div class="quantity-add">
            <label>Quantity:</label>
            <input type="number" id="quantity" value="1" min="1" style="width:60px; padding:4px;" />
        </div>

        <button class="btn btn-add-to-cart" data-productid="@Model.RowKey">Add to Cart</button>
        <p id="add-cart-message" style="margin-top:8px; color:green; display:none;">✅ Added to cart!</p>
    </div>
</div>

<style>
    .product-details-container {
        display: flex;
        gap: 32px;
        margin: 24px;
    }

    .product-image img {
        width: 300px;
        height: 300px;
        object-fit: contain;
        border-radius: 8px;
    }

    .product-info {
        max-width: 400px;
    }

    .product-fields dt {
        font-weight: bold;
        margin-top: 12px;
    }

    .product-fields dd {
        margin: 0 0 8px 0;
    }

    .btn-add-to-cart {
        padding: 8px 16px;
        background: #B9375E;
        color: #fff;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        margin-top: 12px;
    }

    .quantity-add {
        margin-top: 12px;
        display: flex;
        align-items: center;
        gap: 8px;
    }
</style>

<script>
        document.querySelector('.btn-add-to-cart').addEventListener('click', async () => {
        const productId = document.querySelector('.btn-add-to-cart').dataset.productid;
        const quantity = parseInt(document.getElementById('quantity').value);

        const response = await fetch('/Cart/Add', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ productId, quantity })
        });

        if (response.ok) {
            const msg = document.getElementById('add-cart-message');
            msg.style.display = 'block';
            setTimeout(() => msg.style.display = 'none', 2000);
        } else {
            alert('❌ Failed to add product to cart.');
        }
    });

</script>
