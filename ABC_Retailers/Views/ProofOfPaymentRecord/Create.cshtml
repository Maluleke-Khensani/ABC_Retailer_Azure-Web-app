@model ABC_Retailers.Models.ProofOfPaymentRecord
@using ABC_Retailers.Models.ViewModels
@inject IHttpContextAccessor HttpContextAccessor

@{
    var user = HttpContextAccessor.HttpContext?.User;
    Layout = (user != null && user.IsInRole("Admin")) ? "_LayoutAdmin" : "_LayoutCustomer";
    ViewBag.Title = "Confirm Order & Upload Proof";

    var cartItems = ViewBag.CartItems as List<CartItemViewModel> ?? new();
    double total = cartItems.Sum(i => i.Subtotal);
}

@if (TempData["Message"] != null)
{
    <div class="alert alert-success fade-out">@TempData["Message"]</div>
}


<style>
    body {
        background: #F2F2F2;
        font-family: "Segoe UI";
        color: #434343;
        margin: 0;
    }

    .container {
        background: #fff;
        padding: 24px;
        border-radius: 8px;
        max-width: 800px;
        margin: 30px auto;
    }

    h2 {
        color: #B9375E;
        margin-bottom: 16px;
    }

    table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 20px;
    }

    th, td {
        padding: 10px;
        border-bottom: 1px solid #eee;
    }

    th {
        background: #434343;
        color: #fff;
    }

    .btn {
        padding: 10px 16px;
        border-radius: 6px;
        border: none;
        cursor: pointer;
        font-weight: 600;
    }

    .btn-success {
        background: #BE9A60;
        color: #fff;
    }

        .btn-success:hover {
            background: #a07f4b;
        }
</style>

<div class="container">
    <h2>Confirm Your Order</h2>

    <div class="summary">
        <p><strong>Customer:</strong> @User.Identity?.Name</p>
        <p><strong>Order Date:</strong> @DateTime.Now.ToString("yyyy-MM-dd")</p>
    </div>

    <table>
        <thead>
            <tr>
                <th>Product</th>
                <th>Qty</th>
                <th>Price</th>
                <th>Total</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var item in cartItems)
            {
                <tr>
                    <td>@item.ProductName</td>
                    <td>@item.Quantity</td>
                    <td>@item.UnitPrice.ToString("C")</td>
                    <td>@item.Subtotal.ToString("C")</td>
                </tr>
            }
        </tbody>
        <tfoot>
            <tr>
                <td colspan="3" style="text-align:right;"><strong>Grand Total:</strong></td>
                <td><strong>@total.ToString("C")</strong></td>
            </tr>
        </tfoot>
    </table>

    <hr />

    <h3 style="color:#BE9A60;">Upload Proof of Payment</h3>

    <form asp-action="Create" method="post" enctype="multipart/form-data">
        <input type="hidden" name="CustomerUsername" value="@User.Identity?.Name" />

        <div class="mb-3">
            <label>Payment Date</label>
            <input type="date" name="PaymentDate" class="form-control" value="@DateTime.Now.ToString("yyyy-MM-dd")" required />
        </div>

        <div class="mb-3">
            <label>Proof of Payment (JPG, PNG, PDF)</label>
            <input type="file" name="ProofOfPayment" accept=".jpg,.jpeg,.png,.pdf" class="form-control" required />
        </div>

        <button type="submit" class="btn btn-success">Confirm Order</button>
    </form>
</div>
